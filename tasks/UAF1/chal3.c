#include "chal3.h"
#include <stdio.h>

Note* noteList[4];

int count = 0;

void printNoteData(Note *note)
{
  printf("%s\n", note->data);
}

void win()
{
  system("/bin/sh");
}

void addNote()
{
  if(count > 3)
  {
    printf("Full notes\n");
    return;
  }
  int size;
  char buf[16];
  for(int i = 0; i < 4; i++)
    {
      if(!noteList[i]){
        noteList[i] = (Note *)malloc(sizeof(struct Note));     
        count++;  
        noteList[i]->print_note = printNoteData;
        puts("Enter your note size: ");
        read(0, buf, 16);
        size = atoi(buf);
        noteList[i]->data = (char *)malloc(size);
        puts("Enter ur data: ");
        read(0, noteList[i]->data, size);
        puts("Success\n");
        break;
      }
    }
}

void delNote()
{
  int index; 
  char tmp[3];

  printf("Input index to del:\n");

  read(0, tmp, 3);
  index = atoi(tmp);

  if(index < 0 || index >= count)
  {
    printf("Bad index\n");
    return;
  }
  
  if(noteList[index])
  {
    free(noteList[index]->data);
    free(noteList[index]);
    printf("Success delete\n");
  }

}

void printNote()
{
  int index;
  char tmp[3];
  puts("Input ur index:\n");
  read(0, tmp, 3);

  index = atoi(tmp);

  if(index < 0 || index >= count)
  {
    printf("Bad index\n");
    return;
  }

  if(noteList[index])
  {
    noteList[index]->print_note(noteList[index]);
  }
}

void init()
{
  setvbuf(stdout, 0, 2, 0);
  setvbuf(stdin, 0, 2, 0);
  setvbuf(stderr, 0, 2, 0);
}

void menu() {
  puts(" 1. Add note          ");
  puts(" 2. Delete note       ");
  puts(" 3. Print note        ");
  puts(" 4. Exit              ");
  printf("Your choice :");
};

int main()
{
  init(); 
  int choice;

  while(1)
    {
      menu();
      scanf("%d", &choice);
      switch (choice) 
      {
        case 1:
          addNote();
          continue;
        case 2:
          delNote();
          continue;
        case 3:
          printNote();
          continue;
        case 4:
          printf("Bye)\n");
          break;
        default:
          printf("Ivalid option\n");
          break;
      }
      break;
    }

  return 0;
}
